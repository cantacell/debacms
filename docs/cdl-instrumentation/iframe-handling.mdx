---
sidebar_label: Iframe Handling
sidebar_position: 8
id: Iframe Handling
toc_min_heading_level: 2
toc_max_heading_level: 4
---

## iFrame Handling within Common Data Layer

There are no extra actions required to instrument the Pixall library loaded in an iframe.
And it uses the same [rules to push events](./sending-events.mdx) to `coxAutoDataLayer`.
(This iframe behavior does not work for the old \_pxam.push Pixall event method described here [Instrumentation option 2](../legacy-instrumentation/legacy-events-instrumentation.mdx)).

When instrumenting you must be aware of specific state behavior:

### Case 1: event is propagated to the top
Data pushed to `coxAutoDataLayer` on iframe will be automatically propagated to the top window and then added to `coxAutoDataLayer`
on the top window. This occurs when two conditions satisfy:

    - the Pixall library is loaded in the top window
    - the Pixall library in the top window has enabled CDL functionality.
In this case all top window `coxAutoDataLayer` subscribers will receive notification the same way as for the regular
top level `coxAutoDataLayer` [subscription behavior](./subscribe-to-cdl-events.mdx). Note that new state property `iframeContext` will be created at top level.
It will store all CDL fields (except `eventProperties`).

```js title='Example:'
// top CDL state
{
   vehicle: {
       make: 'Subaru'
   }
}

// iframe CDL push after which iframe CDL state is:
{
     eventProperties: {
	     action: 'myevent'
     },
     application: {
         name: 'iframeApp'
     },
	   myProperty: '123'
}

// top CDL push (happens automatically on iframe CDL push)
{
     eventProperties: {
	     action: 'myevent'
     },
     iframeContext: {
         application: {
             name: 'iframeApp'
         },
	     myProperty: '123'
     }
}
```

New top CDL state:

```js
{
     vehicle: {
         make: 'Subaru'
     },
     eventProperties: {
	     action: 'myevent'
     },
     iframeContext: {
         application: {
             name: 'iframeApp'
         },
	     myProperty: '123'
     }
}
```

:::note
1. `eventProperties` object will be stored at top level, rather than being stored inside `iframeContext`.
2. Values in `iframeContext` as well as values in `eventProperties` do not store their state for future calls.
:::

### Case 2: event is not propagated to the top
The only cases when iframe can directly send events to Pixall server are when Pixall library does not exist at top window
or when CDL functionality is not enabled for top Pixall library.
In these scenarios no data will be propagated to the top and top window `coxAutoDataLayer` subscribers will not be notified.
Library will behave as a standalone and `iframeContext` object will not be created in state.

```js title='Example:'
// iframe CDL state
{
   application: {
       name: 'iframeApp',
   }
}

// iframe CDL push
coxAutoDataLayer.push({
   eventProperties: {
      action: 'myevent'
   },
   myProperty: '123'
});

// no top level Pixall library exist
// or CDL functionality is not enabled for top Pixall library
```

New iframe CDL state:

```js
{
     eventProperties: {
	     action: 'myevent'
     },
     application: {
         name: 'iframeApp'
     },
     myProperty: '123'
}
```
