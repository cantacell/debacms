---
sidebar_label: State
sidebar_position: 4
id: State
toc_min_heading_level: 2
toc_max_heading_level: 4
---

## Update the Data Layer's State

**Any** push into `coxAutoDataLayer` updates the data layer's state.

```js title='Example:'
coxAutoDataLayer.push({abc: 123})
console.log(coxAutoDataLayer.getState().abc) // 123
```

Another example:

Current state:

```js
{
  'application': {
    'componentId': '123456',
    'version': '1.0',
    'isProduction': false
  }
}
```

:::note
Some fields will be added
<span style={{fontStyle: 'italic'}}>[**automatically**](./autogenerated-fields.mdx) to the state.</span>
:::



New data layer push:

```js
coxAutoDataLayer.push({
  application: {
    name: 'my application name'
  }
});
```

New state:

```js
{
  'application': {
    'componentId': '123456',
    'version': '1.0',
    'isProduction': false,
    'name': 'my application name'
  }
}
```

### Mechanism used to update Data Layer's State
When a new push is performed on `coxAutoDataLayer`, a merge mechanism is applied.
Only when a field is an Array then a substitution is applied.
- Pushing an object as a new field:

```js
// Current state:
{
  'application': {
    'componentId': '123456'
  },
}

// Pushing 'myObject' with 'myProp'
coxAutoDataLayer.push({
  'myObject': {
    'myProp': 1
  }
});

// New state
{
  'application': {
    'componentId': '123456'
  },
  'myObject': {
    'myProp': 1
  }
}
```

- Pushing an object as an existing field:
```js
// Current state:
{
  'application': {
    'componentId': '123456'
  },
}

// Pushing 'application' with 'myProp'
coxAutoDataLayer.push({
  application: {
    'myProp': 1
  }
});

// New state
{
  'application': {
    'componentId': '123456',
    'myProp': 1
  }
}
```

- Pushing an array as a new field:
```js
// Current state:
{
  'application': {
    'componentId': '123456'
  },
}

// Pushing 'myObject' with 'myArray'
coxAutoDataLayer.push({
  'myObject': {
    'myArray': [1, 2, 3]
  }
});

// New state
{
  'application': {
    'componentId': '123456',
  },
  'myObject': {
    'myArray': [1, 2, 3]
  }
}
```

- Pushing an array as an existing field:
```js
// Current state:
{
  'application': {
    'componentId': '123456'
  },
  'myObject': {
    'myArray': [1, 2, 3]
  }
}

// Pushing 'myObject' with 'myArray'
coxAutoDataLayer.push({
  'myObject': {
    'myArray': [4, 5, 6]
  }
});

// New state
{
  'application': {
    'componentId': '123456',
  },
  'myObject': {
    'myArray': [4, 5, 6] // <--- the array values are overriden
  }
}
```

## Remove a persisted state field

To remove a persisted state field it is enough to make a data layer push with `undefined` as the value of the field interested to be removed:

Current state:

```js
{
  'application': {
    'componentId': '123456'
  },
  vehicle: {
    make: 'Subaru'
  }
}
```

Removing vehicle field:

```js
coxAutoDataLayer.push({
  vehicle: undefined
});
```

New state:

```js
{
  'application': {
    'componentId': '123456'
  }
}
```

## Reset the Data Layer's State

Removes all the fields, and re-run the process of initialization of the state.

Current state:

```js
{
  'application': {
    'componentId': '123456'
  },
  vehicle: {
    vehicleMake: 'Subaru'
  },
  testField: 'test',
}
```

Reseting state:

```js
coxAutoDataLayer.resetState();
```

New state:

```js
{
  'application': {
    'componentId': '123456'
  }
}
```

## Retrieve current Data Layer's State

To retrieve the current Data Layer's State use the `coxAutoDataLayer.getState` function. It will return a copy of the state.

Example:

Current state:

```js
{
  'application': {
    'componentId': '123456',
    'version': '1.0',
    'isProduction': false
  }
}
```

Invoking `coxAutoDataLayer.getState` it will return:

```js
{
  'application': {
    'componentId': '123456',
    'version': '1.0',
    'isProduction': false
  }
}
```
